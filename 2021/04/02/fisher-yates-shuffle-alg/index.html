<!DOCTYPE html>
<html lang="zh-Hans">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="解衣又作茶瓜客，倚槛同看烟雨峰">
    

    <!--Author-->
    
        <meta name="author" content="茶瓜客">
    

    <!-- Title -->
    
    <title>Fisher Yates 洗牌算法 | 茶瓜客</title>

    <!-- Bootstrap Core CSS -->
    <link href="//cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/style.css">


    <!-- Custom Fonts -->
    <link href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Noto+Serif:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- jQuery -->
    <script src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="//cdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="茶瓜客" type="application/atom+xml">
</head>

<body>

    <!-- Content -->
    <section class="article-container">
    <!-- Back Home -->
    <a class="nav-back" href="/">
    <i class="fa fa-puzzle-piece"></i>
</a>

        <!-- Page Header -->
        <header class="intro-header">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                        <div class="post-heading">
                            <h1>
                                Fisher Yates 洗牌算法
                            </h1>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Post Content -->
        <article>
            <div class="container">
                <div class="row">
                    <!-- Post Main Content -->
                    <div class="post-content col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                        <p>洗牌算法从一个排序组合的数组，得到另一个随机排序组合的数组。下面介绍在原数组上随机打乱顺序的做法。</p>
<h1 id="不加权模式"><a href="#不加权模式" class="headerlink" title="不加权模式"></a>不加权模式</h1><p>Fisher Yates洗牌算法凭借着$O(1)$空间、$O(n)$时间复杂度，实现了“在n个不同的数中随机取出m个数”一类的问题。</p>
<p>实现大致是将从未抽取集合中随机抽中的数x与未抽取集合中的最后一个数交换，未抽取集合个数-1。不断重复，直至未抽取集合个数为0。</p>
<p>实现细节：</p>
<ul>
<li><p>已知原始数组长度为n，将原始数组分为未抽取数组（长度为n）和取出数组（长度为0）。</p>
</li>
<li><p>在未抽取数组中，<strong>随机</strong>（算法依赖这个’随机‘是否够随机）选中一个数p，将数p的位置与原始数组最后一位（首位也行）交换。</p>
</li>
<li><p>重复上一个步骤，直到未抽取数组的个数为0。</p>
</li>
</ul>
<p><em>有点像选择排序，差异在于每次在’未排序‘区中找的不是最小（或最大）的，而是随机选一个。</em></p>
<p>实现代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">void shuffle(int *arr,int nLen)</span><br><span class="line">&#123;</span><br><span class="line">    for (size_t i &#x3D; nLen - 1; i &gt; 0; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        int num &#x3D; rand() % i;</span><br><span class="line">        std::swap(arr[i], arr[num]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>算法脱离数学是不讲武德的，下面就证明：集合set有n个不同的数字，第i次抽取到的数字p的概率是否是都是$\frac{1}{n}$ 。</p>
<ul>
<li><p>第i次才抽中数字p，那么前i-1次都是没抽到数字p的。</p>
</li>
<li><p>第一次抽取，没抽到数字p的概率是$\frac{n-1}{n}$。</p>
</li>
<li><p>第二次抽取，没抽到数字p的概率是$\frac{n-1}{n} × \frac{n-2}{n-1}$。</p>
</li>
</ul>
<p>……</p>
<ul>
<li><p>第i-1次抽取，没抽到数字p的概率是$\frac{n-1}{n} × \frac{n-2}{n-1} × ··· × \frac{n-i}{n-i+1}$。</p>
</li>
<li><p>第i次抽取，抽到数字p的概率是$\frac{n-1}{n} × \frac{n-2}{n-1} × ··· × \frac{n-i}{n-i+1} × \frac{1}{n-i} = \frac{1}{n}$。</p>
</li>
</ul>
<p>Fisher Yates洗牌算法有两个随机因子，一个是每一次从未抽取集合抽取的元素，另一个是每一次未抽取集合最后一个元素，但最关键是第一个随机因子。</p>
<p>假如为每个元素加上权重，使得每个元素本身被抽中的优先度不一样，又如何用Fisher Yates洗牌算法来实现呢？</p>
<h1 id="加权模式"><a href="#加权模式" class="headerlink" title="加权模式"></a>加权模式</h1><p>一个比较笨重的办法,将元素按照其权重展开:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;a:2,b:3,c:1&#125;</span><br><span class="line">&#123;a,a,b,b,b,c&#125;</span><br></pre></td></tr></table></figure>
<p>（但显然不是好办法。=_=）</p>
<p>因为有了权重作为附加条件，再按照上面”从未抽取集合中随机抽取一个元素“的方式是不满足条件的，必须将权重参与到运算中（随机抽取）。</p>
<p>那么，可以将所有权重值加起来，得到一个权重总数sum，然后在0到sum的范围内随机产生一个数num，再将num与未抽取集合中每一个元素作某种比较，最后输出随机数。</p>
<p>步骤如下：</p>
<ul>
<li><p>统计出所有元素的权重和sum。</p>
</li>
<li><p>在0到sum之间随机产生一个随机数num，遍历未抽取集合。</p>
</li>
<li><p>用随机数num和当前迭代元素n比较。假如num小于n，结束迭代，返回元素n（与最后一位元素交换），sum-=n，重复第二步；假如num大于n，则num-=n，继续迭代。</p>
</li>
<li><p>遍历到未抽取集合的最后一个元素时，如果num大于n，则输出最后一个元素，sum-=n。</p>
</li>
<li><p>重复第二步。</p>
</li>
</ul>
<p>代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">void shuffle2(int *arr, int nLen)</span><br><span class="line">&#123;</span><br><span class="line">    int sum &#x3D; 0;</span><br><span class="line">    for (size_t i &#x3D; 0; i &lt; nLen; i++)&#123;</span><br><span class="line">	sum +&#x3D; arr[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for (size_t i &#x3D; nLen - 1; i &gt; 0; i--) &#123;</span><br><span class="line">	int num &#x3D; rand() % sum;</span><br><span class="line">	size_t j &#x3D; 0;</span><br><span class="line">	for (; j &lt; i; j++)&#123;</span><br><span class="line">	    if (num &gt; arr[j]) &#123;</span><br><span class="line">		num -&#x3D; arr[j];</span><br><span class="line">	    &#125;</span><br><span class="line">	    else &#123;</span><br><span class="line">		break;</span><br><span class="line">	    &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	sum -&#x3D; arr[j];</span><br><span class="line">	std::swap(arr[i], arr[j]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>空间复杂度还是$O(1)$，但时间复杂度是$O(n+n^2)$。</p>


                            <!-- Meta -->
                            <div class="post-meta">
                                <hr>
                                <br>
                                <div class="post-tags">
                                    
                                        

<a href="/tags/洗牌算法/">#洗牌算法</a>


                                            
                                </div>
                                <div class="post-date">
                                    
                                        2021-04-02
                                    
                                </div>
                            </div>
                    </div>

                    <!-- Comments -->
                    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                        <!-- Disqus Comments -->


                    </div>
                </div>
            </div>
        </article>
</section>

<!-- Image viewer-->

    <!-- Custom picture view-->
    <link href="/css/viewer.min.css" rel="stylesheet" />
    <script
      src="/js/viewer.min.js"
      type="text/javascript"
      charset="utf-8"
    ></script>
    
    <script type="text/javascript">
      // set image viewer
      Viewer.setDefaults({
        zoomRatio: [0.5],
        navbar: false,
        toolbar: false,
        button: false,
        title: [2, (image, imageData) => `${image.alt}`],
        show: function() {
          this.viewer.zoomTo(0.5);
        }
      });
      var imageList = document.getElementsByTagName("img");
      Array.prototype.forEach.call(imageList, element => {
        var viewer = new Viewer(element);
      });
    </script>

    

<!-- TOC -->

    <aside id="article-toc" role="navigation" class="fixed">
        <div id="article-toc-inner">
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%8D%E5%8A%A0%E6%9D%83%E6%A8%A1%E5%BC%8F"><span class="toc-text">不加权模式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%A0%E6%9D%83%E6%A8%A1%E5%BC%8F"><span class="toc-text">加权模式</span></a></li></ol>
        </div>
    </aside>

    <!-- Scripts -->
    <script type="text/javascript">
    console.log("© zchen9 🙋 2015-" + new Date().getFullYear());
</script>
  
    <!-- Google Analytics -->
    

    <!-- Service Worker -->
    <!-- if using service worker -->

    
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>

</html>