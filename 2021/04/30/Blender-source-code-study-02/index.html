<!DOCTYPE html>
<html lang="zh-Hans">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="解衣又作茶瓜客，倚槛同看烟雨峰">
    

    <!--Author-->
    
        <meta name="author" content="茶瓜客">
    

    <!-- Title -->
    
    <title>Blender源码学习（二）——一些重要的结构体 | 茶瓜客</title>

    <!-- Bootstrap Core CSS -->
    <link href="//cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/style.css">


    <!-- Custom Fonts -->
    <link href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Noto+Serif:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- jQuery -->
    <script src="//cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="//cdn.bootcss.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="茶瓜客" type="application/atom+xml">
</head>

<body>

    <!-- Content -->
    <section class="article-container">
    <!-- Back Home -->
    <a class="nav-back" href="/">
    <i class="fa fa-puzzle-piece"></i>
</a>

        <!-- Page Header -->
        <header class="intro-header">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                        <div class="post-heading">
                            <h1>
                                Blender源码学习（二）——一些重要的结构体
                            </h1>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Post Content -->
        <article>
            <div class="container">
                <div class="row">
                    <!-- Post Main Content -->
                    <div class="post-content col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                        <h1 id="bContext结构体"><a href="#bContext结构体" class="headerlink" title="bContext结构体"></a>bContext结构体</h1><p><strong>定义</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;context.c</span><br><span class="line">struct bContext &#123;</span><br><span class="line">  int thread;</span><br><span class="line"></span><br><span class="line">  &#x2F;* windowmanager context *&#x2F;</span><br><span class="line">  struct &#123;</span><br><span class="line">    struct wmWindowManager *manager;</span><br><span class="line">    struct wmWindow *window;</span><br><span class="line">    struct WorkSpace *workspace;</span><br><span class="line">    struct bScreen *screen;</span><br><span class="line">    struct ScrArea *area;</span><br><span class="line">    struct ARegion *region;</span><br><span class="line">    struct ARegion *menu;</span><br><span class="line">    struct wmGizmoGroup *gizmo_group;</span><br><span class="line">    struct bContextStore *store;</span><br><span class="line"></span><br><span class="line">    &#x2F;* Operator poll. *&#x2F;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Store the reason the poll function fails (static string, not allocated).</span><br><span class="line">     * For more advanced formatting use &#96;operator_poll_msg_dyn_params&#96;.</span><br><span class="line">     *&#x2F;</span><br><span class="line">    const char *operator_poll_msg;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * Store values to dynamically to create the string (called when a tool-tip is shown).</span><br><span class="line">     *&#x2F;</span><br><span class="line">    struct bContextPollMsgDyn_Params operator_poll_msg_dyn_params;</span><br><span class="line">  &#125; wm;</span><br><span class="line"></span><br><span class="line">  &#x2F;* data context *&#x2F;</span><br><span class="line">  struct &#123;</span><br><span class="line">    struct Main *main;</span><br><span class="line">    struct Scene *scene;</span><br><span class="line"></span><br><span class="line">    int recursion;</span><br><span class="line">    &#x2F;** True if python is initialized. *&#x2F;</span><br><span class="line">    bool py_init;</span><br><span class="line">    void *py_context;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * If we need to remove members, do so in a copy</span><br><span class="line">     * (keep this to check if the copy needs freeing).</span><br><span class="line">     *&#x2F;</span><br><span class="line">    void *py_context_orig;</span><br><span class="line">  &#125; data;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>bContext结构体是Blender程序的上下文（整个程序只有一个），包含窗口管理者上下文（windowmanager context）和数据上下文（data context）。</p>
<p>bContext结构体中的对象通常使用<code>CTX_data_*</code>和<code>CTX_wm_*</code>函数中获取，并且其参数通常是延迟初始化。</p>
<p>bContext结构体对象在<code>creator.c</code>文件的<code>main</code>函数中创建，在<code>main</code>函数中使用情况如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">bContext *C;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">C &#x3D; CTX_create();</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">main_args_setup(C, ba);</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">WM_init(C, argc, (const char **)argv);</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">CTX_py_init_set(C, true);</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">WM_keyconfig_init(C);</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">FRS_set_context(C);</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">main_args_setup_post(C, ba);</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">#ifndef WITH_PYTHON_MODULE</span><br><span class="line">  if (G.background) &#123;</span><br><span class="line">    &#x2F;* Using window-manager API in background-mode is a bit odd, but works fine. *&#x2F;</span><br><span class="line">    WM_exit(C);</span><br><span class="line">  &#125;</span><br><span class="line">  else &#123;</span><br><span class="line">    if (!G.file_loaded) &#123;</span><br><span class="line">      WM_init_splash(C);</span><br><span class="line">    &#125;</span><br><span class="line">    WM_main(C);</span><br><span class="line">  &#125;</span><br><span class="line">#endif &#x2F;* WITH_PYTHON_MODULE *&#x2F;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="Global"><a href="#Global" class="headerlink" title="Global"></a>Global</h1><p><strong>定义</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;BKE_global.h</span><br><span class="line">typedef struct Global &#123;</span><br><span class="line"></span><br><span class="line">  &#x2F;** Active pointers. *&#x2F;</span><br><span class="line">  struct Main *main;</span><br><span class="line"></span><br><span class="line">  &#x2F;** Strings: last saved *&#x2F;</span><br><span class="line">  char ima[1024], lib[1024]; &#x2F;* 1024 &#x3D; FILE_MAX *&#x2F;</span><br><span class="line"></span><br><span class="line">  &#x2F;** When set: &#96;G_MAIN-&gt;name&#96; contains valid relative base path. *&#x2F;</span><br><span class="line">  bool relbase_valid;</span><br><span class="line">  bool file_loaded;</span><br><span class="line">  bool save_over;</span><br><span class="line"></span><br><span class="line">  &#x2F;** Strings of recent opened files. *&#x2F;</span><br><span class="line">  struct ListBase recent_files;</span><br><span class="line"></span><br><span class="line">  &#x2F;** Has escape been pressed or Ctrl+C pressed in background mode, used for render quit. *&#x2F;</span><br><span class="line">  bool is_break;</span><br><span class="line"></span><br><span class="line">  bool background;</span><br><span class="line">  bool factory_startup;</span><br><span class="line"></span><br><span class="line">  short moving;</span><br><span class="line"></span><br><span class="line">  &#x2F;** To indicate render is busy, prevent render-window events etc. *&#x2F;</span><br><span class="line">  bool is_rendering;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * Debug value, can be set from the UI and python, used for testing nonstandard features.</span><br><span class="line">   * DO NOT abuse it with generic checks like &#96;if (G.debug_value &gt; 0)&#96;. Do not use it as bitflags.</span><br><span class="line">   * Only precise specific values should be checked for, to avoid unpredictable side-effects.</span><br><span class="line">   * Please document here the value(s) you are using (or a range of values reserved to some area).</span><br><span class="line">   *   * -16384 and below: Reserved for python (add-ons) usage.</span><br><span class="line">   *   *     -1: Disable faster motion paths computation (since 08&#x2F;2018).</span><br><span class="line">   *   * 1 - 30: EEVEE debug&#x2F;stats values (01&#x2F;2018).</span><br><span class="line">   *   *    101: Enable UI debug drawing of fullscreen area&#39;s corner widget (10&#x2F;2014).</span><br><span class="line">   *   *    666: Use quicker batch delete for outliners&#39; delete hierarchy (01&#x2F;2019).</span><br><span class="line">   *   *    777: Enable UI node panel&#39;s sockets polling (11&#x2F;2011).</span><br><span class="line">   *   *    799: Enable some mysterious new depsgraph behavior (05&#x2F;2015).</span><br><span class="line">   *   *   1112: Disable new Cloth internal springs handling (09&#x2F;2014).</span><br><span class="line">   *   *   1234: Disable new dyntopo code fixing skinny faces generation (04&#x2F;2015).</span><br><span class="line">   *   *   3001: Enable additional Fluid modifier (Mantaflow) options (02&#x2F;2020).</span><br><span class="line">   *   *   4000: Line Art state output and debugging logs (03&#x2F;2021).</span><br><span class="line">   *   * 16384 and above: Reserved for python (add-ons) usage.</span><br><span class="line">   *&#x2F;</span><br><span class="line">  short debug_value;</span><br><span class="line"></span><br><span class="line">  &#x2F;** Saved to the blend file as #FileGlobal.globalf,</span><br><span class="line">   * however this is now only used for runtime options. *&#x2F;</span><br><span class="line">  int f;</span><br><span class="line"></span><br><span class="line">  struct &#123;</span><br><span class="line">    &#x2F;** Logging vars (different loggers may use). *&#x2F;</span><br><span class="line">    int level;</span><br><span class="line">    &#x2F;** FILE handle or use stderr (we own this so close when done). *&#x2F;</span><br><span class="line">    void *file;</span><br><span class="line">  &#125; log;</span><br><span class="line"></span><br><span class="line">  &#x2F;** debug flag, #G_DEBUG, #G_DEBUG_PYTHON &amp; friends, set python or command line args *&#x2F;</span><br><span class="line">  int debug;</span><br><span class="line"></span><br><span class="line">  &#x2F;** This variable is written to &#x2F; read from #FileGlobal.fileflags *&#x2F;</span><br><span class="line">  int fileflags;</span><br><span class="line"></span><br><span class="line">  &#x2F;** Message to use when auto execution fails. *&#x2F;</span><br><span class="line">  char autoexec_fail[200];</span><br><span class="line">&#125; Global;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;blender.c</span><br><span class="line">Global G;</span><br></pre></td></tr></table></figure>
<p>Global结构体主要是存放一些全局定义的变量、处于激活状态的节点（Active pointers）对象指针以及已经打开的文件链表（Strings of recent opened files）对象指针。</p>


                            <!-- Meta -->
                            <div class="post-meta">
                                <hr>
                                <br>
                                <div class="post-tags">
                                    
                                        

<a href="/tags/blender源码/">#blender源码</a>


                                            
                                </div>
                                <div class="post-date">
                                    
                                        2021-04-30
                                    
                                </div>
                            </div>
                    </div>

                    <!-- Comments -->
                    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                        <!-- Disqus Comments -->


                    </div>
                </div>
            </div>
        </article>
</section>

<!-- Image viewer-->

    <!-- Custom picture view-->
    <link href="/css/viewer.min.css" rel="stylesheet" />
    <script
      src="/js/viewer.min.js"
      type="text/javascript"
      charset="utf-8"
    ></script>
    
    <script type="text/javascript">
      // set image viewer
      Viewer.setDefaults({
        zoomRatio: [0.5],
        navbar: false,
        toolbar: false,
        button: false,
        title: [2, (image, imageData) => `${image.alt}`],
        show: function() {
          this.viewer.zoomTo(0.5);
        }
      });
      var imageList = document.getElementsByTagName("img");
      Array.prototype.forEach.call(imageList, element => {
        var viewer = new Viewer(element);
      });
    </script>

    

<!-- TOC -->

    <aside id="article-toc" role="navigation" class="fixed">
        <div id="article-toc-inner">
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#bContext%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-text">bContext结构体</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Global"><span class="toc-text">Global</span></a></li></ol>
        </div>
    </aside>

    <!-- Scripts -->
    <script type="text/javascript">
    console.log("© zchen9 🙋 2015-" + new Date().getFullYear());
</script>
  
    <!-- Google Analytics -->
    

    <!-- Service Worker -->
    <!-- if using service worker -->

    
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>

</html>